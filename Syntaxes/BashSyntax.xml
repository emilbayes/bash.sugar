<?xml version="1.0" encoding="UTF-8"?>

<syntax name="sourcecode.bash">

    <zones>
        <include collection="comment"/>
        <include collection="pipeline"/>
        <include collection="list"/>
        <include collection="compound-command"/>
        <include collection="loop"/>
        <include collection="function-definition"/>
        <include collection="string"/>
        <include collection="variable"/>
        <include collection="interpolation"/>
        <include collection="heredoc"/>
        <include collection="herestring"/>
        <include collection="redirection"/>
        <include collection="pathname"/>
        <include collection="number"/>
        <include collection="keyword"/>
        <include collection="support"/>
    </zones>

    <library>
        <collection name="case-clause">
            <zone name="meta.scope.case-clause.bash">
                <starts-with>
                    <expression>(?=\S)</expression>
                </starts-with>
                <ends-with>
                    <expression>;;</expression>
                    <capture number="0" name="punctuation.terminator.case-clause"/>
                </ends-with>
                <subzones>
                    <zone name="meta.scope.case-pattern.bash">
                        <starts-with>
                            <expression>(\(|(?=\S))</expression>
                            <capture number="0" name="punctuation.definition.case-pattern.begin"/>
                        </starts-with>
                        <ends-with>
                            <expression>\)</expression>
                            <capture number="0" name="punctuation.definition.case-pattern.end"/>
                        </ends-with>
                        <subzones>
                            <zone name="punctuation.separator.pipe-sign">
                                <expression>\|</expression>
                            </zone>
                            <include collection="string"/>
                            <include collection="variable"/>
                            <include collection="interpolation"/>
                            <include collection="pathname"/>
                        </subzones>
                    </zone>
                    <zone name="meta.scope.case-clause-body.bash">
                        <starts-with>
                            <expression>(?&lt;=\))</expression>
                        </starts-with>
                        <ends-with>
                            <expression>(?=;;)</expression>
                        </ends-with>
                        <subzones>
                            <include syntax="self"/>
                        </subzones>
                    </zone>
                </subzones>
            </zone>
        </collection>
        <collection name="comment">
            <zone name="comment.line.number-sign.bash">
                <expression>(#).*($)\n?</expression>
                <capture number="1" name="punctuation.definition.comment.begin" />
                <capture number="2" name="punctuation.definition.comment.end" />
            </zone>
        </collection>
        <collection name="compound-command">
            <zone name="meta.scope.logical-expression.bash">
                <starts-with>
                    <expression>(\[{2})</expression>
                    <capture number="1" name="punctuation.definition.scope.begin"/>
                </starts-with>
                <ends-with>
                    <expression>(\]{2})</expression>
                    <capture number="1" name="punctuation.definition.scope.end"/>
                </ends-with>
                <subzones>
                    <include collection="logical-expression"/>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="meta.scope.logical-expression.bash">
                <starts-with>
                    <expression>(\[)</expression>
                    <capture number="1" name="punctuation.definition.scope.begin"/>
                </starts-with>
                <ends-with>
                    <expression>(\])</expression>
                    <capture number="1" name="punctuation.definition.scope.end"/>
                </ends-with>
                <subzones>
                    <include collection="logical-expression"/>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="string.other.math.bash">
                <starts-with>
                    <expression>(\({2})</expression>
                    <capture number="1" name="punctuation.definition.string.begin"/>
                </starts-with>
                <ends-with>
                    <expression>(\){2})</expression>
                    <capture number="1" name="punctuation.definition.string.end"/>
                </ends-with>
                <subzones>
                    <include collection="math"/>
                </subzones>
            </zone>
            <zone name="meta.scope.subshell.bash">
                <starts-with>
                    <expression>(\()</expression>
                    <capture number="1" name="punctuation.definition.scope.begin"/>
                </starts-with>
                <ends-with>
                    <expression>(\))</expression>
                    <capture number="1" name="punctuation.definition.scope.end"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="meta.scope.group.bash">
                <starts-with>
                    <expression>(?&lt;=\s|^)(\{)(?=\s|$)</expression>
                    <capture number="1" name="punctuation.definition.scope.begin"/>
                </starts-with>
                <ends-with>
                    <expression>(?&lt;=^|;)\s*(\})</expression>
                    <capture number="1" name="punctuation.definition.scope.end"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
        </collection>
        <collection name="function-definition">
            <zone name="meta.function.bash">
                <starts-with>
                    <expression>\b(function)\s+((?:[^\s\\]|\\.)+)(?:\s*(\(\)))?</expression>
                    <capture number="1" name="storage.type.function.bash"/>
                    <capture number="2" name="entity.name.function.bash"/>
                    <capture number="3" name="punctuation.definition.arguments"/>
                </starts-with>
                <ends-with>
                    <expression>;|&amp;|$</expression>
                    <capture number="0" name="punctuation.terminator.function"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="meta.function.bash">
                <starts-with>
                    <expression>\b((?:[^\s\\]|\\.)+)\s*(\(\))</expression>
                    <capture number="1" name="entity.name.function.bash"/>
                    <capture number="2" name="punctuation.definition.arguments"/>
                </starts-with>
                <ends-with>
                    <expression>;|&amp;|$</expression>
                    <capture number="0" name="punctuation.terminator.function"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
        </collection>
        <collection name="heredoc">
            <zone name="string.unquoted.heredoc.no-indent.bash">
                <starts-with>
                    <expression>(&lt;&lt;)-("|'|)\\?(\w+)(\2)</expression>
                    <capture number="1" name="keyword.operator.heredoc.bash"/>
                    <capture number="2" name="punctuation.definition.token.begin"/>
                    <capture number="3" name="keyword.control.heredoc-token.bash"/>
                    <capture number="4" name="punctuation.definition.token.end"/>
                </starts-with>
                <ends-with>
                    <expression>^\t*(\3)$</expression>
                    <capture number="1" name="keyword.control.heredoc-token.bash"/>
                </ends-with>
            </zone>
            <zone name="string.unquoted.heredoc.bash">
                <starts-with>
                    <expression>(&lt;&lt;)("|'|)\\?(\w+)(\2)</expression>
                    <capture number="1" name="keyword.operator.heredoc.bash"/>
                    <capture number="2" name="punctuation.definition.token.begin"/>
                    <capture number="3" name="keyword.control.heredoc-token.bash"/>
                    <capture number="4" name="punctuation.definition.token.end"/>
                </starts-with>
                <ends-with>
                    <expression>^(\3)$</expression>
                    <capture number="1" name="keyword.control.heredoc-token.bash"/>
                </ends-with>
            </zone>
        </collection>
        <collection name="herestring">
            <zone name="meta.herestring.bash">
                <expression>(&lt;&lt;&lt;)((')[^']*('))</expression>
                <capture number="1" name="keyword.operator.herestring.bash"/>
                <capture number="2" name="string.quoted.single.herestring.bash"/>
                <capture number="3" name="punctuation.definition.string.begin"/>
                <capture number="4" name="punctuation.definition.string.end"/>
            </zone>
            <zone name="meta.herestring.bash">
                <expression>(&lt;&lt;&lt;)((")(?:\\(?:"|\\)|[^"\\])*("))</expression>
                <capture number="1" name="keyword.operator.herestring.bash"/>
                <capture number="2" name="string.quoted.double.herestring.bash"/>
                <capture number="3" name="punctuation.definition.string.begin"/>
                <capture number="4" name="punctuation.definition.string.end"/>
            </zone>
            <zone name="meta.herestring.bash">
                <expression>(&lt;&lt;&lt;)((?:[^\s\\]|\\.)+)</expression>
                <capture number="1" name="keyword.operator.herestring.bash"/>
                <capture number="2" name="string.unquoted.herestring.bash"/>
            </zone>
        </collection>
        <collection name="interpolation">
            <zone name="string.other.math.bash">
                <starts-with>
                    <expression>\$\({2}</expression>
                    <capture number="0" name="punctuation.definition.string.begin"/>
                </starts-with>
                <ends-with>
                    <expression>\){2}</expression>
                    <capture number="0" name="punctuation.definition.string.end"/>
                </ends-with>
                <subzones>
                    <include collection="math"/>
                </subzones>
            </zone>
            <zone name="string.interpolated.backtick.bash">
                <starts-with>
                    <expression>`</expression>
                    <capture number="0" name="punctuation.definition.string.begin"/>
                </starts-with>
                <ends-with>
                    <expression>`</expression>
                    <capture number="0" name="punctuation.definition.string.end"/>
                </ends-with>
                <subzones>
                    <zone name="constant.character.escape.bash">
                        <expression>\\[`\\$]</expression>
                    </zone>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="string.interpolated.dollar.bash">
                <starts-with>
                    <expression>\$\(</expression>
                    <capture number="0" name="punctuation.definition.string.begin"/>
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="punctuation.definition.string.end"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
        </collection>
        <collection name="keyword">
            <zone name="keyword.control.bash">
                <expression>\b(?:if|then|else|elif|fi|for|in|do|done|select|case|continue|esac|while|until|return)\b</expression>
            </zone>
            <zone name="storage.modifier.bash">
                <expression>\b(?:export|declare|typeset|local|readonly)\b</expression>
            </zone>
        </collection>
        <collection name="list">
            <zone name="keyword.operator.list.bash">
                <expression>;|&amp;&amp;|&amp;|\|\|</expression>
            </zone>
        </collection>
        <collection name="logical-expression">
            <zone name="keyword.operator.logical.bash">
                <expression>=[=~]?|!=?|&lt;|>|&amp;&amp;|\|\|</expression>
            </zone>
            <zone name="keyword.operator.logical.bash">
                <expression>-(nt|ot|ef|eq|ne|l[te]|g[te]|[a-hknoprstuwxzOGLSN])</expression>
            </zone>
        </collection>
        <collection name="loop">
            <zone name="meta.block.for.bash">
                <starts-with>
                    <expression>\b(for)\s+(?=\({2})</expression>
                    <capture number="1" name="keyword.control.block.open.bash"/>
                </starts-with>
                <ends-with>
                    <expression>\b(done)\b</expression>
                    <capture number="1" name="keyword.control.block.close.bash"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="meta.block.for-in.bash">
                <starts-with>
                    <expression>\b(for)\s+((?:[^\s\\]|\\.)+)\b</expression>
                    <capture number="1" name="keyword.control.block.open.bash"/>
                    <capture number="2" name="variable.loop.bash"/>
                </starts-with>
                <ends-with>
                    <expression>\b(done)\b</expression>
                    <capture number="1" name="keyword.control.block.close.bash"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="meta.block.while.bash">
                <starts-with>
                    <expression>\b(while|until)\b</expression>
                    <capture number="1" name="keyword.control.block.open.bash"/>
                </starts-with>
                <ends-with>
                    <expression>\b(done)\b</expression>
                    <capture number="1" name="keyword.control.block.close.bash"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="meta.block.select.bash">
                <starts-with>
                    <expression>\b(select)\s+((?:[^\s\\]|\\.)+)\b</expression>
                    <capture number="1" name="keyword.control.block.open.bash"/>
                    <capture number="2" name="variable.loop.bash"/>
                </starts-with>
                <ends-with>
                    <expression>\b(done)\b</expression>
                    <capture number="1" name="keyword.control.block.close.bash"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="meta.block.case.bash">
                <starts-with>
                    <expression>\b(case)\b</expression>
                    <capture number="1" name="keyword.control.block.open.bash"/>
                </starts-with>
                <ends-with>
                    <expression>\b(esac)\b</expression>
                    <capture number="1" name="keyword.control.block.close.bash"/>
                </ends-with>
                <subzones>
                    <zone name="meta.scope.case-body.bash">
                        <starts-with>
                            <expression>\b(in)\b</expression>
                            <capture number="1" name="keyword.control.block.bash"/>
                        </starts-with>
                        <ends-with>
                            <expression>(?=\b(?:esac)\b)</expression>
                        </ends-with>
                        <subzones>
                            <include collection="case-clause"/>
                            <include syntax="self"/>
                        </subzones>
                    </zone>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="meta.block.if.bash">
                <starts-with>
                    <expression>\b(if)\b</expression>
                    <capture number="1" name="keyword.control.block.open.bash"/>
                </starts-with>
                <ends-with>
                    <expression>\b(fi)\b</expression>
                    <capture number="1" name="keyword.control.block.close.bash"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
        </collection>
        <collection name="math">
            <include collection="variable"/>
            <zone name="keyword.operator.arithmetic.bash">
                <expression>\+{1,2}|-{1,2}|!|~|\*{1,2}|/|%|&lt;[&lt;=]?|>[>=]?|==|!=|^|\|{1,2}|&amp;{1,2}|\?|\:|,|=|[*/%+\-&amp;^|]=|&lt;&lt;=|>>=</expression>
            </zone>
            <zone name="constant.numeric.hex.bash">
                <expression>0[xX]\h+</expression>
            </zone>
            <zone name="constant.numeric.octal.bash">
                <expression>0\d+</expression>
            </zone>
            <zone name="constant.numeric.other.bash">
                <expression>\d{1,2}#[0-9a-zA-Z@_]+</expression>
            </zone>
            <zone name="constant.numeric.integer.bash">
                <expression>\d+</expression>
            </zone>
        </collection>
        <collection name="number">
            <zone name="constant.numeric.bash">
                <expression>\d+(?=\s|$)</expression>
            </zone>
        </collection>
        <collection name="pathname">
            <zone name="keyword.operator.tilde.bash">
                <expression>(?&lt;=\s|:|=|^)~</expression>
            </zone>
            <zone name="keyword.operator.glob.bash">
                <expression>\*|\?</expression>
            </zone>
            <zone name="meta.scope.extglob.bash">
                <starts-with>
                    <expression>([?*+@!])(\()</expression>
                    <capture number="1" name="keyword.operator.extglob.bash"/>
                    <capture number="2" name="punctuation.definition.scope.begin"/>
                </starts-with>
                <ends-with>
                    <expression>(\))</expression>
                    <capture number="1" name="punctuation.definition.scope.end"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
        </collection>
        <collection name="pipeline">
            <zone name="keyword.other.bash">
                <expression>\b(time)\b</expression>
            </zone>
            <zone name="keyword.operator.pipe.bash">
                <expression>[|!]</expression>
            </zone>
        </collection>
        <collection name="redirection">
            <zone name="string.interpolated.process-substitution.bash">
                <starts-with>
                    <expression>[>&lt;]\(</expression>
                    <capture number="0" name="punctuation.definition.string.begin"/>
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="punctuation.definition.string.end"/>
                </ends-with>
                <subzones>
                    <include syntax="self"/>
                </subzones>
            </zone>
            <zone name="keyword.operator.redirect.bash">
                <expression>&amp;>|\d*>&amp;\d*|\d*(>>|>|&lt;)|\d*&lt;&amp;|\d*&lt;></expression>
            </zone>
        </collection>
        <collection name="string">
            <zone name="constant.character.escape.bash">
                <expression>\\.</expression>
            </zone>
            <zone name="string.quoted.single.bash">
                <starts-with>
                    <expression>'</expression>
                    <capture number="0" name="punctuation.definition.string.begin"/>
                </starts-with>
                <ends-with>
                    <expression>'</expression>
                    <capture number="0" name="punctuation.definition.string.end"/>
                </ends-with>
            </zone>
            <zone name="string.quoted.double.bash">
                <starts-with>
                    <expression>\$?"</expression>
                    <capture number="0" name="punctuation.definition.string.begin"/>
                </starts-with>
                <ends-with>
                    <expression>"</expression>
                    <capture number="0" name="punctuation.definition.string.end"/>
                </ends-with>
                <subzones>
                    <zone name="constant.character.escape.bash">
                        <expression>\\[\$`"\\\n]</expression>
                    </zone>
                    <include collection="variable"/>
                    <include collection="interpolation"/>
                </subzones>
            </zone>
            <zone name="string.quoted.single.dollar.bash">
                <starts-with>
                    <expression>\$'</expression>
                    <capture number="0" name="punctuation.definition.string.begin"/>
                </starts-with>
                <ends-with>
                    <expression>'</expression>
                    <capture number="0" name="punctuation.definition.string.end"/>
                </ends-with>
                <subzones>
                    <zone name="constant.character.escape.ansi-c.bash">
                        <expression>\\(a|b|e|f|n|r|t|v|\\|')</expression>
                    </zone>
                    <zone name="constant.character.escape.octal.bash">
                        <expression>\\[0-9]{3}</expression>
                    </zone>
                    <zone name="constant.character.escape.hex.bash">
                        <expression>\\x[0-9a-fA-F]{2}</expression>
                    </zone>
                    <zone name="constant.character.escape.control-char.bash">
                        <expression>\\c.</expression>
                    </zone>
                </subzones>
            </zone>
        </collection>
        <collection name="support">
            <zone name="support.function.builtin.bash">
                <expression>(?&lt;=^|\s)(?::|\.)(?=\s|;|&amp;|$)</expression>
            </zone>
            <zone name="support.function.builtin.bash">
                <expression>\b(?:alias|bg|bind|break|builtin|caller|cd|command|compgen|complete|dirs|disown|echo|enable|eval|exec|exit|false|fc|fg|getopts|hash|help|history|jobs|kill|let|logout|popd|printf|pushd|pwd|read|readonly|set|shift|shopt|source|suspend|test|times|trap|true|type|ulimit|umask|unalias|unset|wait)\b</expression>
            </zone>
        </collection>
        <collection name="variable">
            <zone name="variable.other.special.bash">
                <expression>(\$)[-*@#?$!0_]</expression>
                <capture number="1" name="punctuation.definition.variable"/>
            </zone>
            <zone name="variable.other.positional.bash">
                <expression>(\$)[1-9]</expression>
                <capture number="1" name="punctuation.definition.variable"/>
            </zone>
            <zone name="variable.other.normal.bash">
                <expression>(\$)[a-zA-Z_][a-zA-Z0-9_]*</expression>
                <capture number="1" name="punctuation.definition.variable"/>
            </zone>
            <zone name="variable.other.bracket.bash">
                <starts-with>
                    <expression>\$\{</expression>
                    <capture number="0" name="punctuation.definition.variable.begin"/>
                </starts-with>
                <ends-with>
                    <expression>\}</expression>
                    <capture number="0" name="punctuation.definition.variable.end"/>
                </ends-with>
                <subzones>
                    <zone name="keyword.operator.expansion.bash">
                        <expression>!|:[-=?]?|\*|@|#{1,2}|%{1,2}|/</expression>
                    </zone>
                    <zone>
                        <expression>(\[)([^\]]+)(\])</expression>
                        <capture number="1" name="punctuation.section.array.bash"/>
                        <capture number="3" name="punctuation.section.array.bash"/>
                    </zone>
                </subzones>
            </zone>
        </collection>

    </library>

</syntax>
